services:
  db:
    image: mariadb
    user: ${UID}:${GID}
    environment:
      - MARIADB_USER=${DB_USER}
      - MARIADB_PASSWORD=${DB_PASSWORD}
      - MARIADB_ROOT_PASSWORD=${DB_ROOT_PASSWORD}
    ports:
      - ${DB_PORT}:3306
    volumes:
      - ${DB_VOLUME}:/var/lib/mysql
    restart: unless-stopped

  server:
    build:
      context: .
      args:
        - UID=${UID}
        - GID=${GID}
        - SERVER_JAR_URL=${SERVER_JAR_URL}
    depends_on:
      - db
    user: ${UID}:${GID}
    links:
      - db
    ports:
      - ${SERVER_PORT}:25565
      - ${SERVER_DYNMAP_PORT}:8123
    volumes:
      - ${SERVER_VOLUME}:/server
    stdin_open: true
    tty: true
    restart: unless-stopped